<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- THIS LINE IS USED TO CHANGE THE FONTS -->
        <link href="https://fonts.googleapis.com/css2?family=Barlow:ital,wght@0,300;0,400;0,500;0,700;1,400;1,700&display=swap" rel="stylesheet">
        
        
        
        <link rel="shortcut icon" href="../../img/icon.png">
        <title>Blocks - Introduction | Rubik</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/js.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a href="../.."><span style="font-weight: bold; font-size: 18px;">Rubik</span></a><span style="padding-right: 1.5em;padding-left: 0.2em;">[alpha]</span>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon">
                        <i class="fa fa-bars" style="font-size:28px;"></i>
                    </span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">APIs <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../apis/" class="dropdown-item">Core</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Blocks</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../about/release-notes/" class="nav-link">Releases</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../apis/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../../about/release-notes/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/rubikorg/rubik" target="_blank" class="nav-link"><i class="fa fa-github"></i> 
                                        <!-- GitHub --></a>
                            </li>
                            <li class="nav-item">
                                <a href="https://www.youtube.com/channel/UC_qelGu_taTq8NSROkAPE9g" target="_blank" class="nav-link">
                                    <i class="fa fa-youtube"></i> 
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="0"><a href="#list-of-available-blocks" class="nav-link">List of Available Blocks</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="0"><a href="#about-blocks" class="nav-link">About Blocks</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="1"><a href="#writing-a-block" class="nav-link">Writing a Block</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="1"><a href="#attaching-a-block" class="nav-link">Attaching a Block</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="1"><a href="#best-practices" class="nav-link">Best Practices</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="1"><a href="#getting-a-block" class="nav-link">Getting a Block</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="1"><a href="#accessible-apis-by-blocks" class="nav-link">Accessible APIs by Blocks</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#decode" class="nav-link">Decode</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#config" class="nav-link">Config</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#currenturl" class="nav-link">CurrentURL</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#routetree" class="nav-link">RouteTree</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">
                        

<h1 id="list-of-available-blocks">List of Available Blocks<a class="headerlink" href="#list-of-available-blocks" title="Permanent link"></a></h1>
<p>Take a look at some blocks that the <a href="https://github.com/codekidX">@author</a> has made until we get some more contributions:</p>
<ul>
<li><a href="/blocks/httplogger">Simple HTTPLogger Block</a> - A Rubik block for logging request path and response times.
<!-- - <a href="/blocks/swagger">Rubik Swagger Block</a> - A customised swagger implementation that automatically generates Swagger docs of your Rubik routes. --></li>
<li><a href="/blocks/healthcheck">HealthCheck Block</a> - Readily appends a route for health check services like 
kubernetes etc..</li>
</ul>
<h1 id="about-blocks">About Blocks<a class="headerlink" href="#about-blocks" title="Permanent link"></a></h1>
<p>Components that are independant of the core system is called as a block. Blocks can never depend
on a specific nature of the server yet provide extended functionality to your Rubik server.</p>
<p>It can be seen as plugin system of Rubik ecosystem, but -- it has some features that tie it to 
the boot sequence of the Rubik's core thereby eventually making it part of the system.</p>
<h2 id="writing-a-block">Writing a Block<a class="headerlink" href="#writing-a-block" title="Permanent link"></a></h2>
<p>Writing a block is as simple as implementing a singl method, thet serves as the <code>main</code> func for
your extension. A <code>struct</code> is considered as a Rubik Block only if you implement the <code>OnAttach</code> method
of the <code>rubik.Block</code> interface.</p>
<p>So what does it look like?</p>
<p>:: myawesomeblock.go</p>
<pre><code class="go">package awesome

import (
    &quot;fmt&quot;
    r &quot;github.com/rubikorg/rubik&quot;
)

type BlockAwesome struct{}

func (a BlockAwesome) OnAttach(app *r.App) error {
    // block code
    fmt.Println(&quot;awesome block is initialized!&quot;)
    return nil
}
</code></pre>

<p>There are 2 things that catches the eye:</p>
<ol>
<li><code>app</code> parameter - The app parameter is supplied to you by rubik which gives you limited access
to the implementer's server. </li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is not the Rubik instance itself, as this would be too big a vulnerability it supplies
you with only the functions that you need to build a block.</p>
</div>
<ol>
<li><code>error</code> return statement - OnAttach is called first in the boot sequence by Rubik so if you
return an error the server will panic and not start, which is an intended workflow.</li>
</ol>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>If the block can not even initialize properly, it can never function properly.</p>
</div>
<h2 id="attaching-a-block">Attaching a Block<a class="headerlink" href="#attaching-a-block" title="Permanent link"></a></h2>
<p>A block can never be known by the Rubik server until you attach it, it can be done by calling
<code>rubik.Attach</code> inside the <code>init</code> method of this block file.</p>
<p>Considering the above example:</p>
<p>:: myawesomeblock.go</p>
<pre><code class="go">package awesome

import (
    &quot;fmt&quot;
    r &quot;github.com/rubikorg/rubik&quot;
)

type BlockAwesome struct{}

func (a BlockAwesome) OnAttach(app *r.App) error {
    // block code
    fmt.Println(&quot;awesome block is initialized!&quot;)
    return nil
}

func init() {
    r.Attach(&quot;myawesomeblock&quot;, BlockAwesome{})
}
</code></pre>

<p><code>rubik.Attach</code> takes in a <code>(name string, block rubik.Block)</code> as it's parameters.</p>
<h2 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link"></a></h2>
<p>Notice how we had initialized the block? By passing a raw string -- this can prove dangerous while
developers using this block try to Get your Block for usage.</p>
<ul>
<li>It is is always a good practise to declare a <code>BlockName</code> constant inside your block file.
This can prove very useful while <a href="">getting the block</a>.</li>
</ul>
<pre><code class="go">// BlockName is this block's name -- like so
// and pass it inside the Attach method 
const BlockName = &quot;myawesomeblock&quot;
</code></pre>

<ul>
<li>Always Attach it inside the <code>init</code> method. Blocks are inherently separate components and is
designed in such a way too -- so why let developers Attach it separately inside their main file?</li>
</ul>
<h2 id="getting-a-block">Getting a Block<a class="headerlink" href="#getting-a-block" title="Permanent link"></a></h2>
<p>Developers can get your block while implementing their business logic from anywhere in the project.
Since Rubik is a singleton instance it maintaines a map of blocks by the name that you specify.</p>
<p>A very good example of this type of implementation is the <a href="/blocks/cors">CORS</a> block:</p>
<pre><code class="go">import (
    &quot;github.com/rubikorg/blocks/yourBlock&quot;
    r &quot;github.com/rubikorg/rubik&quot;
)

// notice how BlockName came in handy?
var yourBlock = r.GetBlock(yourBlock.BlockName)
</code></pre>

<p><code>r.GetBlock()</code> gets the Block by name, rubik knows that it's a Block <em>(as it satisfies the Block
interface)</em> but compiler just doesn't know which one <em>(yet ..generics please rant!!)</em> ..</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is no possible way that <code>r.GetBlock</code> returns any other Block because of the map and 
unique key that it it maintains. So rest assured while coercing to your Block type.</p>
</div>
<h2 id="accessible-apis-by-blocks">Accessible APIs by Blocks<a class="headerlink" href="#accessible-apis-by-blocks" title="Permanent link"></a></h2>
<h3 id="decode">Decode<a class="headerlink" href="#decode" title="Permanent link"></a></h3>
<p><code>type: Function</code></p>
<p>Decode decodes the internal rubik server config into the struct that you provide. It returns
error if the config is not unmarshalable OR there if there is no config initialized by 
the given name parameter. It is useful when you really want some configs to be present for
your block to work.</p>
<pre><code class="go">func (sb *App) Decode(name string, target interface{}) error {}
</code></pre>

<h3 id="config">Config<a class="headerlink" href="#config" title="Permanent link"></a></h3>
<p><code>type: Function</code></p>
<p>Config gets config by name</p>
<pre><code class="go">func (sb *App) Config(name string) interface{} {}
</code></pre>

<h3 id="currenturl">CurrentURL<a class="headerlink" href="#currenturl" title="Permanent link"></a></h3>
<p><code>type: String</code></p>
<p>It is the localhost prepended current URL of your Rubik server.</p>
<pre><code class="go">app.CurrentURL
</code></pre>

<h3 id="routetree">RouteTree<a class="headerlink" href="#routetree" title="Permanent link"></a></h3>
<p><code>type: Struct</code>
All The initialized Routes and their belongings such as <code>Entity</code>, <code>Description</code> etc.</p>
<pre><code class="go">app.RouteTree
</code></pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A RouteTree is not initialized until boot sequence completes. If you want to make use of the
RouteTree you can use <code>rubik.AttachAfter()</code> which attaches your Block after the boot sequence
is complete.</p>
</div>

                        ---<br/>
                        Caught a mistake or want to contribute to the documentation? <a target="_blank" href="https://github.com/okrubik/okrubik.github.io">Edit on GitHub!</a>
                    </div>
                
            </div>
            
        </div>

        <footer class="col-md-12">
            <p class="mini-text">Copyright &copy; 2019-2020 Ashish Shekar <a href="https://github.com/rubikorg">@rubikorg</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
