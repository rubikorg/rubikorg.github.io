<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Blocks - Rubik</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../..">Rubik</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../..">Home</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Essentials <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../core-concepts/">Project Structure</a>
</li>
                                    
<li >
    <a href="../apis/">APIs</a>
</li>
                                    
<li >
    <a href="../tooling/">Tooling</a>
</li>
                                    
<li >
    <a href="../configuration/">Configuration</a>
</li>
                                    
<li class="active">
    <a href="./">Blocks</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../about/introduction/">Why Rubik?</a>
</li>
                                    
<li >
    <a href="../../about/community/">Community</a>
</li>
                                    
<li >
    <a href="../../about/contributing/">Contributing</a>
</li>
                                    
<li >
    <a href="../../about/release-notes/">Releases</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../configuration/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../../about/introduction/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/rubikorg/rubik"><i class="fa fa-github"></i> GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#about-blocks">About Blocks</a></li>
            <li><a href="#writing-a-block">Writing a Block</a></li>
            <li><a href="#attaching-a-block">Attaching a Block</a></li>
            <li><a href="#best-practises">Best Practises</a></li>
            <li><a href="#getting-a-block">Getting a Block</a></li>
            <li><a href="#accessible-apis-by-blocks">Accessible APIs by Blocks</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="about-blocks">About Blocks<a class="headerlink" href="#about-blocks" title="Permanent link"></a></h1>
<p>Components that are independant of the core system is called as a block. Blocks can never depend
on a specific nature of the server yet provide extended functionality to your Rubik server.</p>
<p>It can be seen as plugin system of Rubik ecosystem, but -- it has some features that tie it to 
the boot sequence of the Rubik's core thereby eventually making it part of the system.</p>
<h2 id="writing-a-block">Writing a Block<a class="headerlink" href="#writing-a-block" title="Permanent link"></a></h2>
<p>Writing a block is as simple as implementing a singl method, thet serves as the <code>main</code> func for
your extension. A <code>struct</code> is considered as a Rubik Block only if you implement the <code>OnAttach</code> method
of the <code>rubik.Block</code> interface.</p>
<p>So what does it look like?</p>
<p>:: myawesomeblock.go</p>
<pre><code class="go">package awesome

import (
    &quot;fmt&quot;
    r &quot;github.com/rubikorg/rubik&quot;
)

type BlockAwesome struct{}

func (a BlockAwesome) OnAttach(app *r.App) error {
    // block code
    fmt.Println(&quot;awesome block is initialized!&quot;)
    return nil
}
</code></pre>

<p>There are 2 things that catches the eye:</p>
<ol>
<li><code>app</code> parameter - The app parameter is supplied to you by rubik which gives you limited access
to the implementer's server. </li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is not the Rubik instance itself, as this would be too big a vulnerability it supplies
you with only the functions that you need to build a block.</p>
</div>
<ol>
<li><code>error</code> return statement - OnAttach is called first in the boot sequence by Rubik so if you
return an error the server will panic and not start, which is an intended workflow.</li>
</ol>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>If the block can not even initialize properly, it can never function properly.</p>
</div>
<h2 id="attaching-a-block">Attaching a Block<a class="headerlink" href="#attaching-a-block" title="Permanent link"></a></h2>
<p>A block can never be known by the Rubik server until you attach it, it can be done by calling
<code>rubik.Attach</code> inside the <code>init</code> method of this block file.</p>
<p>Considering the above example:</p>
<p>:: myawesomeblock.go</p>
<pre><code class="go">package awesome

import (
    &quot;fmt&quot;
    r &quot;github.com/rubikorg/rubik&quot;
)

type BlockAwesome struct{}

func (a BlockAwesome) OnAttach(app *r.App) error {
    // block code
    fmt.Println(&quot;awesome block is initialized!&quot;)
    return nil
}

func init() {
    r.Attach(&quot;myawesomeblock&quot;, BlockAwesome{})
}
</code></pre>

<p><code>rubik.Attach</code> takes in a <code>(name string, block rubik.Block)</code> as it's parameters.</p>
<h2 id="best-practises">Best Practises<a class="headerlink" href="#best-practises" title="Permanent link"></a></h2>
<p>Notice how we had initialized the block? By passing a raw string -- this can prove dangerous while
developers using this block try to Get your Block for usage.</p>
<ul>
<li>It is is always a good practise to declare a <code>BlockName</code> constant inside your block file.
This can prove very useful while <a href="">getting the block</a>.</li>
</ul>
<pre><code class="go">// BlockName is this block's name -- like so
// and pass it inside the Attach method 
const BlockName = &quot;myawesomeblock&quot;
</code></pre>

<ul>
<li>Always Attach it inside the <code>init</code> method. Blocks are inherently separate components and is
designed in such a way too -- so why let developers Attach it separately inside their main file?</li>
</ul>
<h2 id="getting-a-block">Getting a Block<a class="headerlink" href="#getting-a-block" title="Permanent link"></a></h2>
<p>Developers can get your block while implementing their business logic from anywhere in the project.
Since Rubik is a singleton instance it maintaines a map of blocks by the name that you specify.</p>
<p>A very good example of this type of implementation is the <a href="/blocks/cors">CORS</a> block:</p>
<pre><code class="go">import (
    &quot;github.com/rubikorg/blocks/cors&quot;
    r &quot;github.com/rubikorg/rubik&quot;
)

// notice how BlockName came in handy?
var corsMW = r.GetBlock(cors.BlockName).(cors.BlockCors).MW
</code></pre>

<p><code>r.GetBlock()</code> gets the Block by name, rubik knows that it's a Block <em>(as it satisfies the Block
interface)</em> but compiler just doesn't know which one <em>(yet ..generics please rant!!)</em> .. So we
coerce it to the type block that is attached <code>(cors.BlockCors)</code> which has the <code>MW</code> middleware 
method.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is no possible way that <code>r.GetBlock</code> returns any other Block because of the map and 
unique key that it it maintains. So rest assured while coercing to your Block type.</p>
</div>
<h2 id="accessible-apis-by-blocks">Accessible APIs by Blocks<a class="headerlink" href="#accessible-apis-by-blocks" title="Permanent link"></a></h2>
<h3 id="decode">Decode<a class="headerlink" href="#decode" title="Permanent link"></a></h3>
<p><code>type: Function</code></p>
<p>Decode decodes the internal rubik server config into the struct that you provide. It returns
error if the config is not unmarshalable OR there if there is no config initialized by 
the given name parameter. It is useful when you really want some configs to be present for
your block to work.</p>
<pre><code class="go">func (sb *App) Decode(name string, target interface{}) error {}
</code></pre>

<h3 id="config">Config<a class="headerlink" href="#config" title="Permanent link"></a></h3>
<p><code>type: Function</code></p>
<p>Config gets config by name</p>
<pre><code class="go">func (sb *App) Config(name string) interface{} {}
</code></pre>

<h3 id="currenturl">CurrentURL<a class="headerlink" href="#currenturl" title="Permanent link"></a></h3>
<p><code>type: String</code></p>
<p>It is the local host prepended current URL of your Rubik server.</p>
<pre><code class="go">app.CurrentURL
</code></pre>

<h3 id="routetree">RouteTree<a class="headerlink" href="#routetree" title="Permanent link"></a></h3>
<p><code>type: Struct</code>
All The initialized Routes and their belongings such as <code>Entity</code>, <code>Description</code> etc.</p>
<pre><code class="go">app.RouteTree
</code></pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A RouteTree is not initialized until boot sequence completes. If you want to make use of the
RouteTree you can use <code>rubik.AttachAfter()</code> which attaches your Block after the boot sequence
is complete.</p>
</div></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
