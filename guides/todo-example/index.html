<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>Write your first Rubik app :: Rubik | An efficient framework for Go — Welcome to Rubik Docs</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="This tutorial is going to be a really exciting one because you&amp;rsquo;ll interact with Rubik and it&amp;rsquo;s ecosystem direactly.
So in the last tutorial we created a project called helloworld and we ran it using the okrubik CLI. Using that project as a base we are not only going to create a TODO-App backend but we are also going to analyze the whole structure of this Rubik app so let&amp;rsquo;s fasten our seatbelts and Go."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/guides/todo-example/" />
<link href="https://emoji-css.afeld.me/emoji.css" rel="stylesheet">


<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<link href="https://fonts.googleapis.com/css?family=Spectral|Muli:900|Oxygen+Mono&display=swap" rel="stylesheet">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Write your first Rubik app"/>
<meta name="twitter:description" content="In this guide you&#39;ll learn how to set-up a Rubik project and run the server"/>



<meta property="og:title" content="Write your first Rubik app" />
<meta property="og:description" content="In this guide you&#39;ll learn how to set-up a Rubik project and run the server" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/guides/todo-example/" />
<meta property="article:published_time" content="2020-05-31T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2020-05-31T00:00:00&#43;00:00"/><meta property="og:site_name" content="Rubik | An efficient framework for Go" />






  </head>
  <body class="">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/guides/getting-started" class="logo" style="text-decoration: none;">
  
    <img src="/img/icon.png" alt="" />
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
            <li><a href="/guides">Guides</a></li>
        
      
        
            <li><a href="https://pkg.go.dev/github.com/rubikorg/rubik?tab=doc">API Docs</a></li>
        
      
        
            <li><a href="https://github.com/rubikorg/rubik">Source Code</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/guides">Guides</a></li>
      
    
      
        <li><a href="https://pkg.go.dev/github.com/rubikorg/rubik?tab=doc">API Docs</a></li>
      
    
      
        <li><a href="https://github.com/rubikorg/rubik">Source Code</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
        </span>
      
      
    </span>
  </span>
</header>


      <div class="content">
        
  <div class="post">
    <h2 class="post-title"><a href="/guides/todo-example/">Write your first Rubik app</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            2020-05-31
        </span>
      
      <span class="post-author">— Written by Ashish Shekar</span>
      
        <span class="post-read-time">— 5 min read</span>
      
    </div>

    

    

    <div class="post-content">
      

<p>This tutorial is going to be a really exciting one because you&rsquo;ll interact with Rubik and it&rsquo;s ecosystem
direactly.</p>

<p>So in the <a href="/guides/create-project">last tutorial</a> we created a project called <code>helloworld</code> and we ran it
using the <code>okrubik</code> CLI. Using that project as a base we are not only going to create a TODO-App backend but
we are also going to analyze the whole structure of this Rubik app so let&rsquo;s fasten our seatbelts and <code>Go</code>.</p>

<h2 id="project-structure">Project Structure</h2>

<p>The file/directory structure of the initial Rubik app is shown below:</p>

<table>
<thead>
<tr>
<th>File/Folder</th>
<th>Purpose</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>main.go</code></td>
<td>The entrypoint of your Rubik server. This is where your config is loaded and server is started.</td>
</tr>

<tr>
<td><code>config/</code></td>
<td>The TOML configurations of your project is placed here. <code>decl.go</code> is the declaration of your config.</td>
</tr>

<tr>
<td><code>routers/</code></td>
<td>Routers hold group of routes. Routers are grouped by responsibilities/domains in rubik.</td>
</tr>

<tr>
<td><code>routers/*/route.go</code></td>
<td>This file handles the creation of router and addition of routes under this domain.</td>
</tr>

<tr>
<td><code>routers/*/controller.go</code></td>
<td>Corresponding controllers of all routes under this domain can be located here.</td>
</tr>

<tr>
<td><code>routers/import.go</code></td>
<td>This file contains <code>Import</code> function which is the entripoint of all Routers into Rubik.</td>
</tr>

<tr>
<td><code>static/</code></td>
<td>This folder contains all the files that you want to serve statically under <code>/static</code> prefix path.</td>
</tr>

<tr>
<td><code>templates/</code></td>
<td>This folder holds files used for redering template as response.</td>
</tr>

<tr>
<td><code>storage/</code></td>
<td>This folder all files that can be organized and stored using the <code>Storage</code> API of Rubik.</td>
</tr>
</tbody>
</table>

<h2 id="generate-a-router">Generate a Router</h2>

<p>We now know the purpose of each files inside this project, now let&rsquo;s create our <code>todo</code> router:</p>

<pre><code class="language-bash">okrubik gen router -n todo
</code></pre>

<p>This will generate a folder inside <code>./routers/todo</code> and generate our route.go and controller.go file.
In Rubik, routers can be thought of as a subsystem having one purpose OR domain-driven. The purpose of our <code>todo</code>
router is to only interact with the TODO part of our application.</p>

<p>Let&rsquo;s navigate to <code>route.go</code> inside our todo folder that we just created. You&rsquo;ll see something like this:</p>

<pre><code class="language-go">package todo

import (
	r &quot;github.com/rubikorg/rubik&quot;
)

// Router for /todo routes
var Router = r.Create(&quot;/todo&quot;)

var indexRoute = r.Route{
	Path:       &quot;/&quot;,
	Controller: indexCtl,
}

func init() {
	Router.Add(indexRoute)
}
</code></pre>

<p>Let&rsquo;s break each line down and get to know it&rsquo;s meaning. Unlike any other frameworks out there Rubik tries
to be descriptive and easy to read.</p>

<ul>
<li>We are declaring <code>indexRoute</code> as a type of <code>rubik.Route</code></li>
<li>with <code>Path</code> pointing to the root of this router and</li>
<li><code>Controller</code> assigned as <code>indexCtl</code>.</li>
<li>We then add this <code>indexRoute</code> to this <code>Router</code> using the <code>Add</code> method so that this route becomes a part of todo Router.</li>
</ul>

<h2 id="add-a-todo">Add a TODO</h2>

<p>Create a TODO struct before we use it in our <code>route.go</code> code.</p>

<pre><code class="language-go">type todo struct {
	ID 			int
	Title 		string
	Body 		string
	IsFinished 	bool
}
</code></pre>

<p>Create a new &ldquo;add&rdquo; route inside our <code>todo/route.go</code>.</p>

<pre><code class="language-go">var addRoute = r.Route{
	Path:       &quot;/add&quot;,
	Entity: 	todo{}, // NOTICE -- this line
	Controller: addCtl,
}

func init() {
    Router.Add(indexRoute)
    // ADD This to route to our router
    Router.Add(addRoute)
}
</code></pre>

<p>Create our controller called <code>addCtl</code> inside our <code>todo/controller.go</code>.</p>

<pre><code class="language-go">import r &quot;github.com/rubikorg/rubik&quot;

func addCtl(req *r.Request) {
    req.Respond(&quot;I am the add route for TODO app&quot;)
}
</code></pre>

<p>Now let&rsquo;s run our server by doing <code>okrubik run -a server</code> and going to <a href="http;//localhost:4000/todo/add">http;//localhost:4000/todo/add</a>. You&rsquo;ll see the reponse that you have returned using the <code>Respond()</code> method.</p>

<p>For persistance we are going to use a simple <a href="https://www.sqlite.org/index.html">SQLite</a> module for Go and save our todo into a <code>.db</code> file. Let&rsquo;s work on the saving the TODO part which is much more interesting that setting up a Route. We need to initialize a database connection for saving our queries to the <code>.db</code> file. Navigate and open <code>main.go</code> file.</p>

<pre><code class="language-go">package main

import (
	&quot;database/sql&quot; // ADD -- Core SQL module
	cfg &quot;github.com/rubikorg/okrubik/cmd/server/config&quot;

	&quot;github.com/rubikorg/rubik&quot;
	_ &quot;github.com/mattn/go-sqlite3&quot; // ADD -- import sqlite driver
)

func main() {
	var config cfg.ProjectConfig
	err := rubik.Load(&amp;config)
	if err != nil {
		panic(err)
	}

	// ADD -- code to initialize our DB Connetion
	database, err := sql.Open(&quot;sqlite3&quot;, &quot;../../rubik-todo.db&quot;)
	if err != nil {
		// because we can't save todo without db connection
		panic(err)
	}

	// ADD -- sql query to create our todo table inside sqlite
	createQ := &quot;CREATE TABLE IF NOT EXISTS todo (id INTEGER PRIMARY KEY, title TEXT, body TEXT)&quot;
	statement, _ := database.Prepare(createQ)
	statement.Exec()

	// ADD -- this line is used to set our global dependencies
	// Since we only have db connection as our dependency
	// we add it directly
	rubik.SetDep(database)

	routers.Import()

	panic(rubik.Run())
}
</code></pre>

<p>Great! we have setup a Database Connection to our SQLite database and we are now ready to go into
Action mode. Navigate and open <code>controller.go</code> inside our todo router and go to <code>addCtl</code>.</p>

<pre><code class="language-go">package todo

import (
	&quot;database/sql&quot;

	r &quot;github.com/rubikorg/rubik&quot;
)

func indexCtl(req *r.Request) {
	req.Respond(&quot;Hello, this is the todo router!&quot;)
}

func addCtl(req *r.Request) {
	// Get our global dependency
	db, _ := req.GetDep().(*sql.DB)
	// get our todo values from the api
	td, _ := req.Entity.(*todo)

	statement, _ := db.Prepare(&quot;INSERT INTO todo (title, body) VALUES (?, ?)&quot;)
	_, err := statement.Exec(td.Title, td.Body)
	if err != nil {
		req.Throw(500, err)
	}

	req.Respond(&quot;Saved!&quot;)
}
</code></pre>

<p>Now click on this <a href="http://localhost:4000/todo/add?title=Hello&amp;body=World">http://localhost:4000/todo/add?title=Hello&amp;body=World</a> link to see &ldquo;Saved!&rdquo;.</p>

<p>The Rubik&rsquo;s &ldquo;Entity&rdquo; abstraction makes it easy to get the values from <code>query</code> directly to the <code>td</code> variable. Now
we get the list of all save TODOs by creating a <code>/list</code> route.</p>

<ul>
<li>todo/route.go</li>
</ul>

<pre><code class="language-go">var listRoute = r.Route{
	Path:       &quot;/list&quot;,
	Controller: listCtl,
}
</code></pre>

<pre><code class="language-go">Router.Add(listRoute)
</code></pre>

<ul>
<li>todo/controller.go</li>
</ul>

<pre><code class="language-go">func listCtl(req *r.Request) {
	db, _ := req.GetDep().(*sql.DB)
	rows, err := db.Query(&quot;SELECT * FROM todo&quot;)
	if err != nil {
		req.Throw(500, err)
		return
	}

	var todos []todo
	for rows.Next() {
		t := todo{}
		err := rows.Scan(&amp;t.ID, &amp;t.Title, &amp;t.Body)
		if err != nil {
			req.Throw(500, err)
			return
		}

		todos = append(todos, t)
	}

	req.Respond(todos, r.Type.JSON)
}
</code></pre>

<p>This will help us view the TODOs in <code>JSON</code> format and make us feel <strong>awesome</strong>. Go to
<a href="http://localhost:4000/todo/list">http://localhost:4000/todo/list</a>.</p>

<p>Easy right? Rubik is currently in alpha and do not have a lot of documentation or guides. If you
wanna help us put more guides or write for us please visit <a href="/guides/join-us">Join Us Section</a>.</p>

    </div>
    
      <div class="pagination">
        
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="/guides/create-project/">
                <span class="button__icon">←</span>
                <span class="button__text">Create a Rubik Project</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="/guides/rubik-sources/">
                <span class="button__text">Sources of Rubik</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    

    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
    <div class="copyright copyright--user">
      <span>Caught a mistake or want to contribute to the documentation? - <a target="_blank" href="https://github.com/rubikorg/rubikorg.github.io">Edit on GitHub!</a></span>
      <span>© Ashish Shekar 2020</span>
    </div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
