<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Blocks: Runtime Extensions - The Rubik Project</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="prologue.html">Prologue</a></li><li class="chapter-item expanded affix "><a href="resources.html">Resources</a></li><li class="chapter-item expanded "><a href="chapter_1.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="chapter_3.html"><strong aria-hidden="true">2.</strong> Compatibility with Go stdlib</a></li><li class="chapter-item expanded "><a href="chapter_4.html"><strong aria-hidden="true">3.</strong> Commanding your Workspace</a></li><li class="chapter-item expanded "><a href="chapter_5.html"><strong aria-hidden="true">4.</strong> Rubik Components</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="components/guards.html"><strong aria-hidden="true">4.1.</strong> Guards</a></li><li class="chapter-item expanded "><a href="components/assertions.html"><strong aria-hidden="true">4.2.</strong> Assertions</a></li><li class="chapter-item expanded "><a href="components/middlewares.html"><strong aria-hidden="true">4.3.</strong> Middlewares</a></li><li class="chapter-item expanded "><a href="components/entity.html"><strong aria-hidden="true">4.4.</strong> Entity</a></li><li class="chapter-item expanded "><a href="components/controllers.html"><strong aria-hidden="true">4.5.</strong> Controllers</a></li><li class="chapter-item expanded "><a href="lifecycle.html"><strong aria-hidden="true">4.6.</strong> Lifecycle of Rubik</a></li></ol></li><li class="chapter-item expanded "><a href="blocks.html" class="active"><strong aria-hidden="true">5.</strong> Blocks: Runtime Extensions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="blocks/jwt.html"><strong aria-hidden="true">5.1.</strong> JWT Authentication Block</a></li><li class="chapter-item expanded "><a href="blocks/swagger.html"><strong aria-hidden="true">5.2.</strong> Swagger Block</a></li><li class="chapter-item expanded "><a href="blocks/httplogger.html"><strong aria-hidden="true">5.3.</strong> HTTP Logger Block</a></li></ol></li><li class="chapter-item expanded "><a href="changelog.html"><strong aria-hidden="true">6.</strong> Changelog</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">The Rubik Project</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#-blocks-runtime-extensions" id="-blocks-runtime-extensions">ðŸ“¦ Blocks: Runtime Extensions</a></h1>
<p>Components that are independant of the core system is called as a block. Blocks can never depend
on a specific nature of the server yet provide extended functionality to your Rubik server.</p>
<p>It can be seen as plugin system of Rubik ecosystem, but -- it has some features that tie it to
the boot sequence of the Rubik's core thereby eventually making it part of the system.</p>
<h2><a class="header" href="#writing-a-block" id="writing-a-block">Writing a Block</a></h2>
<p>Writing a block is as simple as implementing a singl method, thet serves as the <code>main</code> func for
your extension. A <code>struct</code> is considered as a Rubik Block only if you implement the <code>OnAttach</code> method
of the <code>rubik.Block</code> interface.</p>
<p>So what does it look like?</p>
<h4><a class="header" href="#myawesomeblockgo" id="myawesomeblockgo"><code>&gt; myawesomeblock.go</code></a></h4>
<pre><code class="language-go">package awesome

import (
	&quot;fmt&quot;
	r &quot;github.com/rubikorg/rubik&quot;
)

type BlockAwesome struct{}

func (a BlockAwesome) OnAttach(app *r.App) error {
	// block code
	fmt.Println(&quot;awesome block is initialized!&quot;)
	return nil
}
</code></pre>
<p>There are 2 things that catches the eye:</p>
<ol>
<li><code>app</code> parameter - The app parameter is supplied to you by rubik which gives you limited access
to the implementer's server.</li>
</ol>
<p>!!! Note
This is not the Rubik instance itself, as this would be too big a vulnerability it supplies
you with only the functions that you need to build a block.</p>
<ol start="2">
<li><code>error</code> return statement - OnAttach is called first in the boot sequence by Rubik so if you
return an error the server will panic and not start, which is an intended workflow.</li>
</ol>
<p>!!! Quote
If the block can not even initialize properly, it can never function properly.</p>
<h2><a class="header" href="#attaching-a-block" id="attaching-a-block">Attaching a Block</a></h2>
<p>A block can never be known by the Rubik server until you attach it, it can be done by calling
<code>rubik.Attach</code> inside the <code>init</code> method of this block file.</p>
<p>Considering the above example:</p>
<h4><a class="header" href="#myawesomeblockgo-1" id="myawesomeblockgo-1"><code>&gt; myawesomeblock.go</code></a></h4>
<pre><code class="language-go">package awesome

import (
	&quot;fmt&quot;
	r &quot;github.com/rubikorg/rubik&quot;
)

type BlockAwesome struct{}

func (a BlockAwesome) OnAttach(app *r.App) error {
	// block code
	fmt.Println(&quot;awesome block is initialized!&quot;)
	return nil
}

func init() {
	r.Attach(&quot;myawesomeblock&quot;, BlockAwesome{})
}
</code></pre>
<p><code>rubik.Attach</code> takes in a <code>(name string, block rubik.Block)</code> as it's parameters.</p>
<h2><a class="header" href="#best-practices" id="best-practices">Best Practices</a></h2>
<p>Notice how we had initialized the block? By passing a raw string -- this can prove dangerous while
developers using this block try to Get your Block for usage.</p>
<ul>
<li>It is is always a good practise to declare a <code>BlockName</code> constant inside your block file.
This can prove very useful while <a href="">getting the block</a>.</li>
</ul>
<pre><code class="language-go">// BlockName is this block's name -- like so
// and pass it inside the Attach method
const BlockName = &quot;myawesomeblock&quot;
</code></pre>
<ul>
<li>Always Attach it inside the <code>init</code> method. Blocks are inherently separate components and is
designed in such a way too -- so why let developers Attach it separately inside their main file?</li>
</ul>
<h2><a class="header" href="#getting-a-block" id="getting-a-block">Getting a Block</a></h2>
<p>Developers can get your block while implementing their business logic from anywhere in the project.
Since Rubik is a singleton instance it maintaines a map of blocks by the name that you specify.</p>
<p>A very good example of this type of implementation is the <a href="/blocks/cors">CORS</a> block:</p>
<pre><code class="language-go">import (
    &quot;github.com/rubikorg/blocks/yourBlock&quot;
    r &quot;github.com/rubikorg/rubik&quot;
)

// notice how BlockName came in handy?
var yourBlock = r.GetBlock(yourBlock.BlockName)
</code></pre>
<p><code>r.GetBlock()</code> gets the Block by name, rubik knows that it's a Block <em>(as it satisfies the Block
interface)</em> but compiler just doesn't know which one <em>(yet ..generics please rant!!)</em> ..</p>
<p>!!! Note
There is no possible way that <code>r.GetBlock</code> returns any other Block because of the map and
unique key that it it maintains. So rest assured while coercing to your Block type.</p>
<h2><a class="header" href="#accessible-functions-from-blocks" id="accessible-functions-from-blocks">Accessible Functions from Blocks</a></h2>
<h3><a class="header" href="#decode" id="decode">Decode</a></h3>
<p><code>type: Function</code></p>
<p>Decode decodes the internal rubik server config into the struct that you provide. It returns
error if the config is not unmarshalable OR there if there is no config initialized by
the given name parameter. It is useful when you really want some configs to be present for
your block to work.</p>
<pre><code class="language-go">func (sb *App) Decode(name string, target interface{}) error {}
</code></pre>
<h3><a class="header" href="#config" id="config">Config</a></h3>
<p><code>type: Function</code></p>
<p>Config gets config by name</p>
<pre><code class="language-go">func (sb *App) Config(name string) interface{} {}
</code></pre>
<h3><a class="header" href="#currenturl" id="currenturl">CurrentURL</a></h3>
<p><code>type: String</code></p>
<p>It is the localhost prepended current URL of your Rubik server.</p>
<pre><code class="language-go">app.CurrentURL
</code></pre>
<h3><a class="header" href="#routetree" id="routetree">RouteTree</a></h3>
<p><code>type: Struct</code>
All The initialized Routes and their belongings such as <code>Entity</code>, <code>Description</code> etc.</p>
<pre><code class="language-go">app.RouteTree
</code></pre>
<blockquote>
<p><strong>Note</strong></p>
<p>A RouteTree is not initialized until boot sequence completes. If you want to make use of the
RouteTree you can use <code>rubik.AttachAfter()</code> which attaches your Block after the boot sequence
is complete</p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="lifecycle.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="blocks/jwt.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="lifecycle.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="blocks/jwt.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
